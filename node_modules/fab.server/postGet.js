//////////////
// POST/GET //
//////////////
module.exports = function( write, callback ) {
  var querystring = require( 'querystring' );
  return write( function read( write, head, body ) {
    return fab.queue( function( queue ) {
      var map = []
        , bytesToLoad = parseInt( head.headers[ 'content-length' ] )
        , bytesLoaded = null
        ;
      function trigger ( map ) { 
        var fabObj = querystring.parse( map );
        fabObj.write = function ( string ) { queue( write( string ) ); };
        fabObj.url = head.url.href;
        fabObj.pathname = head.url.pathname;
        callback( fabObj );
      }//END TRIGGER
    
      if ( head.method == 'GET' ) trigger(  head.url.query );
      else if ( head.method == 'POST' ) {
        body( function ( chunk ) {
          if ( chunk ) { 
            map.push( chunk.toString() );
            bytesLoaded += chunk.length;
            if ( bytesLoaded == bytesToLoad ) trigger( map.join('') );
          }//END IF
        });//END BODY
      }//END IF
      return fab.ignore;
    });//END FAB.QUEUE
  });//END WRITE
};//END POST/GET